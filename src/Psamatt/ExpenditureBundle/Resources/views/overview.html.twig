{% extends '::base.html.twig' %}

{% block content %}

	<div class="hero-unit">

		<h1>{{ currentDate.format('F Y') }}</h1>
		{% if notFound is defined %}
			<p class="text-error">{{ currentDate.format('F') }} has not yet been created, therefore an overview is not able to be calculated</p>
			<form method="post" action="{{ path('admin_import', {'year': currentDate.format('Y'), 'month': currentDate.format('n') }) }}" class="form-inline">
				<div class="input-prepend">
					<span class="add-on">{{ CURRENCY }}</span>
					<input type="number" pattern="[0-9]+([,\.][0-9]+)?" step="0.01" min="0" name="salary" placeholder="Monthly Salary" required />
				</div>
				<button type="submit" class="btn">Create now</button>
			</form>
		{% else %}

            {% if currentDate.format('FY') == "now" | date('FY') %}
    			<ul class="pager pull-right">
    				<li class="next">
    					<a href="{{ path('admin_homepage', {'newMonth': 1})}}">Create next month &rarr;</a>
    				</li>
    			</ul>
			{% endif %}
			<p>
				<span class="text-success" id="amountSalary">{{ CURRENCY ~ monthHeader.monthIncome  | number_format(2, '.', ',') }} -
				<span class="text-error" id="totalExpenditure">{{ CURRENCY ~ totalExpenditure | number_format(2, '.', ',') }}</span>
				<span class="text-info" id="amountToPay">({{ CURRENCY ~ (totalExpenditure - totalPaid) | number_format(2, '.', ',') }} still to pay)</span>

				=
				<span class="text-info" id="amountLeft">{{ CURRENCY ~ (monthHeader.monthIncome - totalExpenditure) | number_format(2, '.', ',') }}</span>
			</p>
		{% endif %}
	</div>

	{% if notFound is not defined %}

        {{ include(
            'PsamattExpenditureBundle:historic:monthly_expenditure.html.twig',
            { 'showActions': true }
        ) }}

		<p class="text-info">Fill out fields below to save an expenditure</h2>
		<form method="post" action="{{ path('admin_expenditure_save', {'headerID': monthHeader.id}) }}" name="expenditureForm" class="form-horizontal">

            <input type="hidden" name="expenditureID" value="0" />

			<div class="control-group">
				<label class="control-label" for="inputTitle">Title</label>
				<div class="controls">
					<input type="text" id="inputTitle" name="title" placeholder="Title goes here.." />
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="inputPrice">Price</label>
				<div class="controls">
					<div class="input-prepend">
						<span class="add-on">{{ CURRENCY }}</span>
						<input type="number" pattern="[0-9]+([,\.][0-9]+)?" step="0.01" min="0" id="inputPrice" name="price" placeholder="Price.." />
					</div>
				</div>
			</div>
			<div class="control-group">
				<div class="controls">
					<button type="submit" class="btn">Save</button>
					<button type="reset" class="btn">Reset</button>
				</div>
			</div>
		</form>

	{% endif %}

	<script type="text/javascript">

		function deleteExpenditure(headerID, expenditureID)
		{
			if (confirm('Are you sure you want to delete this record?')) {
				$('tr[data-id='+expenditureID+']').remove();

				$.ajax({
					type: 'POST',
					url: '/admin/month/'+ headerID +'/expenditure/' + expenditureID + '/delete',
				});
			}

			return false;
		}

		function registerPaid(headerID, expenditureID, amount)
		{
			$.ajax({
				type: 'POST',
				url: '/admin/month/' + headerID + '/expenditure/' + expenditureID + '/paid',
				data: { 'amount': amount },
				success: function(){
					$('tr[data-id='+expenditureID+']').addClass('expenditure-paid');

					document.location.reload();
				},
			});

			return false;
		}

		function registerPartPaid(headerID, expenditureID)
		{
			var totalPaid = prompt("How much?","1");

			if (totalPaid != null && totalPaid != "") {
				$.ajax({
					type: 'POST',
					url: '/admin/month/' + headerID + '/expenditure/' + expenditureID + '/paid',
					data: { 'amount': totalPaid },
					success: function(){
						$('tr[data-id='+expenditureID+']').addClass('expenditure-partial-paid');
						document.location.reload();
					},
				});
			}

			return false;
		}
	</script>

{% endblock %}
